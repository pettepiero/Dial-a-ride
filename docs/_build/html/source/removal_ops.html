<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Repair operators" href="repair_ops.html" /><link rel="prev" title="Initial Solution" href="nn_sol.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Removal operators - dial-a-ride documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">dial-a-ride  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">dial-a-ride  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">The project</a></li>
<li class="toctree-l1"><a class="reference internal" href="vrp.html">Vehicle Routing Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="notation.html">Notes on symbols and notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn_sol.html">Initial Solution</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Removal operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="repair_ops.html">Repair operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="vrpstates.html">VRP States and classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/source/removal_ops.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="removal-operators">
<h1>Removal operators<a class="headerlink" href="#removal-operators" title="Link to this heading">¶</a></h1>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p>Removal operators destroy a solution by removing a set of customers from the solution.
This page documents the different heuristics to do this.
The heuristics that are implemented are based on <a class="reference internal" href="references.html#id1" id="id1"><span>[WaSH24]</span></a> and are the following:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#random-removal"><span class="std std-ref">Random removal</span></a></p></li>
<li><p><a class="reference internal" href="#random-route-removal"><span class="std std-ref">Random route removal</span></a></p></li>
<li><p><a class="reference internal" href="#shaw-removal"><span class="std std-ref">Shaw removal</span></a></p></li>
<li><p><a class="reference internal" href="#worst-removal"><span class="std std-ref">Worst removal</span></a></p></li>
<li><p><a class="reference internal" href="#cost-reducing-removal"><span class="std std-ref">Cost reducing removal</span></a></p></li>
</ul>
<p>The <em>Exchange reducing removal</em> heuristic is currently not implemented as it is not
trivial to adapt to the pickup and delivery problem.</p>
<p>The algorithms are implemented in <code class="docutils literal notranslate"><span class="pre">cvrptw/operators/removal.py</span></code>
and <code class="docutils literal notranslate"><span class="pre">cvrptw/operators/wang_operators.py</span></code>. All the algorithms go through the same procedure
when removing customers from the solution. The following figure shows the general flow chart
of the removal procedure:</p>
<a class="reference internal image-reference" href="../_images/removal_procedure.svg"><img alt="Removal procedure flow chart" class="align-center" src="../_images/removal_procedure.svg" style="width: 400px;" />
</a>
</section>
<section id="random-removal">
<span id="id2"></span><h2>Random removal<a class="headerlink" href="#random-removal" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="cvrptw.operators.destroy.random_removal">
<span class="sig-prename descclassname"><span class="pre">cvrptw.operators.destroy.</span></span><span class="sig-name descname"><span class="pre">random_removal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state:</span> <span class="pre">~cvrptw.myvrplib.vrpstates.CvrptwState</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng:</span> <span class="pre">&lt;module</span> <span class="pre">'numpy.random'</span> <span class="pre">from</span> <span class="pre">'/home/pettepiero/tirocinio/.venv/lib/python3.12/site-packages/numpy/random/__init__.py'&gt;</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="vrpstates.html#cvrptw.myvrplib.vrpstates.CvrptwState" title="cvrptw.myvrplib.vrpstates.CvrptwState"><span class="pre">CvrptwState</span></a></span></span><a class="headerlink" href="#cvrptw.operators.destroy.random_removal" title="Link to this definition">¶</a></dt>
<dd><p>Removes customers_to_remove randomly selected customers from the passed-in solution.
Ignores first and last customers in the routes because they are depots.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><dl class="simple">
<dt>state: CvrptwState</dt><dd><p>The solution from which to remove customers.</p>
</dd>
<dt>rng: np.random</dt><dd><p>Random number generator.</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><dl class="simple">
<dt>CvrptwState</dt><dd><p>The solution after applying the destroy operator.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<p>The following flow chart shows the <em>random removal</em> heuristic:</p>
<a class="reference internal image-reference" href="../_images/random_removal.svg"><img alt="Random removal flow chart" class="align-center" src="../_images/random_removal.svg" style="width: 400px;" />
</a>
</section>
<section id="random-route-removal">
<span id="id3"></span><h2>Random route removal<a class="headerlink" href="#random-route-removal" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="cvrptw.operators.destroy.random_route_removal">
<span class="sig-prename descclassname"><span class="pre">cvrptw.operators.destroy.</span></span><span class="sig-name descname"><span class="pre">random_route_removal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state:</span> <span class="pre">~cvrptw.myvrplib.vrpstates.CvrptwState</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng:</span> <span class="pre">&lt;module</span> <span class="pre">'numpy.random'</span> <span class="pre">from</span> <span class="pre">'/home/pettepiero/tirocinio/.venv/lib/python3.12/site-packages/numpy/random/__init__.py'&gt;</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="vrpstates.html#cvrptw.myvrplib.vrpstates.CvrptwState" title="cvrptw.myvrplib.vrpstates.CvrptwState"><span class="pre">CvrptwState</span></a></span></span><a class="headerlink" href="#cvrptw.operators.destroy.random_route_removal" title="Link to this definition">¶</a></dt>
<dd><p>Based on (Wang et. al, 2024). This operator randomly selects customers_to_remove
routes from a given solution and then removes a random customer from each route.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><dl class="simple">
<dt>state: CvrptwState</dt><dd><p>The solution from which to remove customers.</p>
</dd>
<dt>rng: np.random</dt><dd><p>Random number generator.</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><dl class="simple">
<dt>CvrptwState</dt><dd><p>The solution after applying the destroy operator.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<p>The following flow chart shows the <em>random route removal</em> heuristic:</p>
<a class="reference internal image-reference" href="../_images/random_route_removal.svg"><img alt="Random route removal flow chart" class="align-center" src="../_images/random_route_removal.svg" style="width: 400px;" />
</a>
</section>
<section id="shaw-removal">
<span id="id4"></span><h2>Shaw removal<a class="headerlink" href="#shaw-removal" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="cvrptw.operators.destroy.shaw_removal">
<span class="sig-prename descclassname"><span class="pre">cvrptw.operators.destroy.</span></span><span class="sig-name descname"><span class="pre">shaw_removal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="vrpstates.html#cvrptw.myvrplib.vrpstates.CvrptwState" title="cvrptw.myvrplib.vrpstates.CvrptwState"><span class="pre">CvrptwState</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="vrpstates.html#cvrptw.myvrplib.vrpstates.CvrptwState" title="cvrptw.myvrplib.vrpstates.CvrptwState"><span class="pre">CvrptwState</span></a></span></span><a class="headerlink" href="#cvrptw.operators.destroy.shaw_removal" title="Link to this definition">¶</a></dt>
<dd><p>Based on (Wang et. al, 2024), formula (4), which is itself based on the work of
Shaw (1997) and Ropke and Pisinger (2006). This operator removes a single
customers from the solution by selecting the most related ones, according to the formula.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><dl class="simple">
<dt>state: CvrptwState</dt><dd><p>The solution from which to remove customers.</p>
</dd>
<dt>rng: np.random</dt><dd><p>Random number generator.</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><dl class="simple">
<dt>CvrptwState</dt><dd><p>The solution after applying the destroy operator.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<p><strong>Notes on this algorithm</strong></p>
<p>The first seed customer is sampled from the list of planned customers only,
instead of the union of planned and unassigned customers. This is because only the planned
customers have the earliest start times available. In the future, it would be interesting to
consider the unassigned customers as well.</p>
<p>Following the notation of reference <a class="reference internal" href="references.html#id1" id="id5"><span>[WaSH24]</span></a>, the relatedness function is given by formula (4) of reference <a class="reference internal" href="references.html#id1" id="id6"><span>[WaSH24]</span></a>:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\text{relatedness}(i, j) = \alpha_1 \frac{d_{ij}}{d^{max}} + \alpha_2 \frac{|e_i - e_j|}{H} + \alpha_3 \frac{|q_i-q_j|}{q^{max}}\]</div>
</div>
<p>where <span class="math notranslate nohighlight">\(d^{max} = \text{max}\left\{ d_{i,j}:i,j \in V_0^p \right\}\)</span> is the maximum
travel distance between any two customers in the set of planned customers
<span class="math notranslate nohighlight">\(V_0^p\)</span>, <span class="math notranslate nohighlight">\(H\)</span> is the time horizon of the problem, and
<span class="math notranslate nohighlight">\(q^{max} = \text{max} \left\{ q_i :i \in V_0^p \right\}\)</span> is the maximum demand among all
customers <span class="math notranslate nohighlight">\(i\)</span> in the set of planned customers <span class="math notranslate nohighlight">\(V_0^p\)</span>.
For the pickup and delivery problem, the equation above is evaluated first for the pickup
nodes, then for the delivery nodes, and the two values are summed up. The customer <em>j</em> that
is removed is the one with the smallest sum.</p>
<p>The following flow chart shows the <em>Shaw removal</em> heuristic:</p>
<a class="reference internal image-reference" href="../_images/shaw-removal.svg"><img alt="Shaw removal flow chart" class="align-center" src="../_images/shaw-removal.svg" style="width: 400px;" />
</a>
</section>
<section id="worst-removal">
<span id="id7"></span><h2>Worst removal<a class="headerlink" href="#worst-removal" title="Link to this heading">¶</a></h2>
<p>The worst removal heuristic is based on calculating a cost associated with each customer,
and removing the customer with the highest cost. In our case, <strong>the cost is calculated as the
increase in the objective function value when the customer is inserted in the arc it is already
currently in</strong>. For example, if the considered customer is customer <span class="math notranslate nohighlight">\(i\)</span> and which is
currently between nodes <span class="math notranslate nohighlight">\((j, k)\)</span>, then the cost measure is given by:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\text{cost}(i) = d_{ji} + d_{ik} - d_{jk}\]</div>
</div>
<p>Where <span class="math notranslate nohighlight">\(d_{ij}\)</span> is the distance between nodes <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>, and so on.</p>
<a class="reference internal image-reference" href="../_images/distance.svg"><img alt="Distances between nodes" class="align-center" src="../_images/distance.svg" style="width: 200px;" />
</a>
<dl class="py function">
<dt class="sig sig-object py" id="cvrptw.operators.destroy.worst_removal">
<span class="sig-prename descclassname"><span class="pre">cvrptw.operators.destroy.</span></span><span class="sig-name descname"><span class="pre">worst_removal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="vrpstates.html#cvrptw.myvrplib.vrpstates.CvrptwState" title="cvrptw.myvrplib.vrpstates.CvrptwState"><span class="pre">CvrptwState</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Generator</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="vrpstates.html#cvrptw.myvrplib.vrpstates.CvrptwState" title="cvrptw.myvrplib.vrpstates.CvrptwState"><span class="pre">CvrptwState</span></a></span></span><a class="headerlink" href="#cvrptw.operators.destroy.worst_removal" title="Link to this definition">¶</a></dt>
<dd><p>Removes customers in decreasing order of service cost.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><dl class="simple">
<dt>state: CvrptwState</dt><dd><p>The solution from which to remove customers.</p>
</dd>
<dt>rng: np.random.Generator</dt><dd><p>Random number generator.</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><dl class="simple">
<dt>CvrptwState</dt><dd><p>The solution after applying the destroy operator.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<p>The following flow chart shows the <em>worst removal</em> heuristic:</p>
<a class="reference internal image-reference" href="../_images/worst_removal.svg"><img alt="Worst removal flow chart" class="align-center" src="../_images/worst_removal.svg" style="width: 400px;" />
</a>
</section>
<section id="cost-reducing-removal">
<span id="id8"></span><h2>Cost reducing removal<a class="headerlink" href="#cost-reducing-removal" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="cvrptw.operators.destroy.cost_reducing_removal">
<span class="sig-prename descclassname"><span class="pre">cvrptw.operators.destroy.</span></span><span class="sig-name descname"><span class="pre">cost_reducing_removal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">state:</span> <span class="pre">~cvrptw.myvrplib.vrpstates.CvrptwState</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng:</span> <span class="pre">&lt;module</span> <span class="pre">'numpy.random'</span> <span class="pre">from</span> <span class="pre">'/home/pettepiero/tirocinio/.venv/lib/python3.12/site-packages/numpy/random/__init__.py'&gt;</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="vrpstates.html#cvrptw.myvrplib.vrpstates.CvrptwState" title="cvrptw.myvrplib.vrpstates.CvrptwState"><span class="pre">CvrptwState</span></a></span></span><a class="headerlink" href="#cvrptw.operators.destroy.cost_reducing_removal" title="Link to this definition">¶</a></dt>
<dd><p>Cost reducing removal operator based on (Wang et al, 2024). Identifies
customers that can be inserted into a solution route at a lower cost. This
includes testing both nodes for the selected customer. The first better solution 
is selected, which means that there might be better solutions that are not found.
A limit on iterations is proposed to terminate the search for potential
customers using this operator.</p>
<dl class="simple">
<dt>Parameters:</dt><dd><dl class="simple">
<dt>state: CvrptwState</dt><dd><p>The solution from which to remove customers.</p>
</dd>
<dt>rng: np.random</dt><dd><p>Random number generator.</p>
</dd>
</dl>
</dd>
<dt>Returns:</dt><dd><dl class="simple">
<dt>CvrptwState</dt><dd><p>The solution after applying the destroy operator.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<p>The following <strong>confusing</strong> flow chart shows the cost reducing removal process, adapted to
pickup and delivery problem. In this figure, <em>partner node</em> refers to the corresponding
pickup or delivery node of a customer. The decision block containing the condition
‘Can <em>w</em> be inserted in some arch at lower cost in the same route?’ hides a loop over either
following nodes or preceding nodes of <em>v</em>, depending on whether <em>v</em> is a pickup or delivery node.
Furthermore, this check is not necessary if the partner node is in a valid position, because this
would already be a better solution than the starting one.</p>
<p>The following flow chart shows the <em>cost reducing removal</em> heuristic:</p>
<a class="reference internal image-reference" href="../_images/cost_reducing_removal.svg"><img alt="Cost reducing removal flow chart" class="align-center" src="../_images/cost_reducing_removal.svg" style="width: 400px;" />
</a>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="repair_ops.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Repair operators</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="nn_sol.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Initial Solution</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Piero Pettenà
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Removal operators</a><ul>
<li><a class="reference internal" href="#description">Description</a></li>
<li><a class="reference internal" href="#random-removal">Random removal</a><ul>
<li><a class="reference internal" href="#cvrptw.operators.destroy.random_removal"><code class="docutils literal notranslate"><span class="pre">random_removal()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#random-route-removal">Random route removal</a><ul>
<li><a class="reference internal" href="#cvrptw.operators.destroy.random_route_removal"><code class="docutils literal notranslate"><span class="pre">random_route_removal()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#shaw-removal">Shaw removal</a><ul>
<li><a class="reference internal" href="#cvrptw.operators.destroy.shaw_removal"><code class="docutils literal notranslate"><span class="pre">shaw_removal()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#worst-removal">Worst removal</a><ul>
<li><a class="reference internal" href="#cvrptw.operators.destroy.worst_removal"><code class="docutils literal notranslate"><span class="pre">worst_removal()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#cost-reducing-removal">Cost reducing removal</a><ul>
<li><a class="reference internal" href="#cvrptw.operators.destroy.cost_reducing_removal"><code class="docutils literal notranslate"><span class="pre">cost_reducing_removal()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>